{
	"$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
	"handler": "Microsoft.Azure.CreateUIDef",
	"version": "0.1.2-preview",
	"parameters": {
		"config": {
			"isWizard": true,
			"basics": { }
		},
		"basics": [
		],
		"steps": [
            {
				"name": "vmStep",
				"label": "Virtual Machine",
				"elements": [
					{
						"name": "deployBastion",
						"type": "Microsoft.Common.CheckBox",
						"label": "Deploy Bastion for jumpbox access? (Recommended)",
						"defaultValue": true,
						"visible": true
					},
					{
						"name": "bastionSection",
						"type": "Microsoft.Common.Section",
						"label": "Bastion",
						"elements": [
							{
								"name": "deployBastionExistingVNet",
								"type": "Microsoft.Common.CheckBox",
								"label": "Deploy Bastion in a Hub and Spoke topology?",
								"defaultValue": false,
								"visible": "[steps('vmStep').vmSection.deployJumpbox]"
							},
							{
								"name": "bastionName",
								"type": "",
								"label": "",
								"defaultValue": "[concat('bastion-', steps('generalStep').resNamingSection.defaultResNamePart)]",
								"tooltip": "Only lowercase alphanumeric characters and hyphens '-' are allowed. Must start and end with letter or number, length of 1-50 characters, and not contain '-ondemand'.",
								"constraints": {
									"required": true,
									"regex": "^[a-zA-Z0-9-._]{1,80}$",
									"validationMessage": "Alphanumeric periods '.', hyphens '-' and underscores '_' are allowed. Must Start with alphanumeric, end with alphanumeric or underscore. Length of 1-80 characters."
								},
								"visible": true
							},
							{
								"name": "bastionVNet",
								"type": "Microsoft.Network.VirtualNetworkCombo",
								"label": {
									"virtualNetwork": "Virtual Network",
									"subnets": "Subnets"
								},
								"toolTip": {
									"virtualNetwork": "Add a Bastion subnet to an existing virtual network.",
									"subnets": ""
								},
								"defaultValue": {
									"name": "",
									"addressPrefixSize": ""
								},
								"constraints": {
									"minAddressPrefixSize": ""
								},
								"options": {
									"hideExisting": false
								},
								"subnets": {
									"bastionSubnet": {
										"label": "Bastion Subnet",
										"defaultValue": {
											"name": "BastionSubnet",
											"addressPrefixSize": "/24"
										},
										"constraints": {
											"minAddressPrefixSize": "/24",
											"minAddressCount": 64
										}
									}
								}
							}

						],
						"visible": "[steps('vmStep').vmSection.deployBastion]"
					}
				]
			}
		],
		"outputs": {
			"defaultNamePart": "[steps('generalStep').resNamingSection.defaultResNamePart]"
		}
	}
}
